<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Chatbot</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; transition: background 0.5s, color 0.5s; }
        .dark-mode { background-color: black; color: white; }
        #chatbox { width: 50%; margin: auto; border: 1px solid black; padding: 10px; background: rgba(255, 255, 255, 0.2); }
        #messages { min-height: 200px; border-bottom: 1px solid gray; padding: 10px; text-align: left; max-height: 300px; overflow-y: auto; }
        input { width: 70%; padding: 10px; }
        button { padding: 10px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body onload="loadChat()">
    <h1>üî• Advanced Chatbot üî•</h1>

    <button onclick="toggleDarkMode()">üåô Dark Mode</button>
    <select id="modeSelect">
        <option value="normal">Normal</option>
        <option value="funny">Funny</option>
        <option value="serious">Serious</option>
    </select>
    <button onclick="toggleMusic()">üéµ Play Music</button>

    <br><br>
    <img id="botAvatar" src="bot.png" width="50">
    <input type="text" id="botName" value="SmartBot">

    <div id="chatbox">
        <div id="messages"></div>
        <input type="text" id="userInput" list="suggestions" placeholder="Ask me something..." onkeypress="handleKeyPress(event)">
        <datalist id="suggestions">
            <option value="hello">
            <option value="how are you">
            <option value="bye">
        </datalist>
        <button onclick="sendMessage()">Send</button>
        <button onclick="startVoiceInput()">üé§ Speak</button>
    </div>

    <audio id="bgMusic" loop>
        <source src="background.mp3" type="audio/mp3">
    </audio>

    <script>
        const botPersonalities = {
            "normal": { "hello": ["Hi!", "Hello!"], "how are you": ["I'm great!", "Doing fine!"], "bye": ["Goodbye!", "See you!"] },
            "funny": { "hello": ["Yo!", "Hey hey!"], "how are you": ["Feeling bot-tastic!", "Just chilling!"], "bye": ["Adios amigo!", "Bye, recharge me!"] },
            "serious": { "hello": ["Greetings.", "State your query."], "how are you": ["Functioning optimally.", "I do not feel."], "bye": ["Farewell.", "Goodbye."] }
        };

        const emojis = { "hello": "üòä", "bye": "üëã", "happy": "üòÅ" };

        function getRandomReply(answers) {
            return answers[Math.floor(Math.random() * answers.length)];
        }

        function sendMessage() {
            let mode = document.getElementById("modeSelect").value;
            let userText = document.getElementById("userInput").value.trim().toLowerCase();
            let messages = document.getElementById("messages");

            if (userText === "") return;

            messages.innerHTML += `<p><strong>You:</strong> ${userText}</p>`;
            messages.innerHTML += `<p id="typingIndicator"><em>Bot is typing...</em></p>`;

            setTimeout(() => {
                document.getElementById("typingIndicator").remove();
                let botResponse = botPersonalities[mode][userText] ? getRandomReply(botPersonalities[mode][userText]) : "I don't understand.";
                botResponse += emojis[userText] ? " " + emojis[userText] : "";

                let botName = document.getElementById("botName").value;
                messages.innerHTML += `<p><strong><img src='bot.png' width='30'> ${botName}:</strong> ${botResponse}</p>`;
                saveChat();
                speak(botResponse);
            }, 1000);
        }

        function handleKeyPress(event) {
            if (event.key === "Enter") sendMessage();
        }

        function startVoiceInput() {
            let recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = "en-US";

            recognition.onresult = function(event) {
                let voiceText = event.results[0][0].transcript;
                document.getElementById("userInput").value = voiceText;
                sendMessage();
            };

            recognition.start();
        }

        function speak(text) {
            let speech = new SpeechSynthesisUtterance(text);
            let voices = speechSynthesis.getVoices();
            speech.voice = voices[0]; 
            speechSynthesis.speak(speech);
        }

        function toggleDarkMode() {
            document.body.classList.toggle("dark-mode");
        }

        function toggleMusic() {
            let music = document.getElementById("bgMusic");
            music.paused ? music.play() : music.pause();
        }

        function saveChat() {
            localStorage.setItem("chatHistory", document.getElementById("messages").innerHTML);
        }

        function loadChat() {
            document.getElementById("messages").innerHTML = localStorage.getItem("chatHistory") || "";
        }

        window.speechSynthesis.onvoiceschanged = function() {
            speechSynthesis.getVoices();
        };
    </script>
</body>
</html>
